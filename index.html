<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>IPL 2026 Mega Auction - Live Viewer + Admin + Bidder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" href="https://iplstatic.s3.amazonaws.com/ipl/logo.png" type="image/png">
<style>
:root {
  --bg-main: #0a0e1a; --bg-card: #1e293b; --text: #e2e8f0; --green: #10b981;
  --red: #ef4444; --gold: #fbbf24; --blue: #3b82f6; --orange: #ff6d00;
  --purple: #a855f7; --border: #334155;
}
* { margin:0; padding:0; box-sizing:border-box; font-family:system-ui,sans-serif; }
body { background:var(--bg-main); color:var(--text); min-height:100vh; }
.container { max-width:1400px; margin:0 auto; padding:15px; }

header { text-align:center; padding:30px; background:linear-gradient(135deg,#1e3a8a,#0f172a); border-bottom:6px solid var(--gold); }
h1 { font-size:3.5rem; color:var(--gold); text-shadow:0 0 30px #000; }
.subtitle { color:#94a3b8; font-size:1.4rem; margin-top:10px; }

.top-bar { display:flex; justify-content:space-between; align-items:center; margin:25px 0; }
.status { padding:12px 28px; border-radius:50px; font-weight:bold; font-size:1.3rem; }
.status.live { background:#166534; color:white; }
.status.stopped { background:#991b1b; color:white; }
.timer { background:var(--bg-card); padding:12px 28px; border-radius:50px; border:2px solid var(--border); font-size:1.5rem; font-weight:bold; }

.grid { display:grid; grid-template-columns:1fr 420px; gap:30px; margin-top:30px; }
@media(max-width:968px) { .grid { grid-template-columns:1fr; } }

.card { background:var(--bg-card); border-radius:20px; padding:30px; border:1px solid var(--border); margin-bottom:25px; }
.player-card { text-align:center; }
.player-photo { width:180px; height:180px; background:#334155; border-radius:50%; margin:0 auto 25px; display:flex; align-items:center; justify-content:center; font-size:80px; font-weight:bold; color:#64748b; }
.current-bid { background:var(--green); color:black; padding:30px; border-radius:20px; font-size:3.5rem; font-weight:bold; margin:30px 0; }
.bid-team { display:flex; align-items:center; justify-content:center; gap:25px; margin:25px 0; }
.team-logo { width:80px; height:80px; background:white; color:var(--bg-main); border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:1.8rem; }
.interested { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin:30px 0; }
.tag { background:#334155; padding:12px 20px; border-radius:30px; font-weight:600; font-size:1rem; }

.team-table, .player-table { width:100%; border-collapse:collapse; }
.team-table th, .player-table th { background:#1e293b; padding:15px; text-align:center; }
.team-table td, .player-table td { padding:12px; border:1px solid var(--border); text-align:center; }

.login-box { max-width:500px; margin:60px auto; background:var(--bg-card); padding:40px; border-radius:20px; text-align:center; box-shadow:0 20px 50px rgba(0,0,0,0.5); }
input { width:100%; padding:18px; margin:15px 0; border-radius:15px; border:none; background:#334155; color:white; font-size:1.2rem; }
.btn { width:100%; padding:18px; border:none; border-radius:15px; font-weight:bold; font-size:1.3rem; cursor:pointer; margin-top:20px; }
.btn-green { background:var(--green); color:black; }
.btn-red { background:var(--red); color:white; }
.btn-blue { background:var(--blue); color:white; }
.btn-orange { background:var(--orange); color:white; }
.btn-purple { background:var(--purple); color:white; }

.not-started { text-align:center; padding:70px; background:var(--red); color:white; border-radius:25px; font-size:2.5rem; font-weight:800; margin:50px 0; }

.admin-panel, .bidder-panel { display:none; margin-top:40px; }
.admin-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:20px; margin-top:30px; }

.hidden { display:none !important; }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>IPL 2026 MEGA AUCTION</h1>
    <p class="subtitle">Live Viewer • Real-time Bidding • Full Control</p>
  </header>

  <div class="top-bar">
    <div class="status stopped" id="statusText">NOT STARTED</div>
    <div class="timer">Time: <span id="timer">01:00</span></div>
  </div>

  <!-- NOT STARTED BANNER -->
  <div class="not-started" id="notStartedBanner">
    AUCTION NOT STARTED
    <br><small style="font-size:1rem;">Waiting for Curator to begin...</small>
  </div>

  <!-- MAIN AUCTION VIEW -->
  <div id="mainView">
    <div class="grid">
      <!-- CURRENT PLAYER -->
      <div>
        <div class="card player">
          <h2 style="color:var(--gold);font-size:2rem;margin-bottom:20px;">CURRENT PLAYER</h2>
          <div class="player-photo" id="playerPhoto">DC</div>
          <h2 id="playerName" style="font-size:3.5rem;margin:20px 0;">Devon Conway</h2>
          <p id="playerInfo" style="font-size:1.6rem;margin:20px 0;">Batsman • New Zealand • Base: ₹2.00 Cr</p>

          <div class="current-bid" id="currentBid">₹ 2.00 Cr</div>

          <div class="bid-team">
            <div class="team-logo" id="bidTeamLogo">--</div>
            <div>
              <div style="opacity:0.8;font-size:1.2rem;">Highest Bidder</div>
              <div id="bidTeamName" style="font-size:2.2rem;font-weight:bold;">No bids yet</div>
            </div>
          </div>

          <div class="interested" id="interestedTeams"></div>

          <div id="soldUnsoldButtons" style="margin-top:40px;display:flex;gap:20px;justify-content:center;">
            <button class="btn btn-green" onclick="soldToCurrent()">SOLD</button>
            <button class="btn btn-red" onclick="unsoldCurrent()">UNSOLD</button>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL -->
      <div>
        <div class="card">
          <h3 style="color:var(--gold);font-size:1.8rem;margin-bottom:20px;">TEAM PURSE & SLOTS</h3>
          <table class="team-table" id="teamTable">
            <thead><tr><th>Team</th><th>Purse</th><th>Slots</th><th>OS</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="card">
          <h3 style="color:var(--gold);font-size:1.8rem;margin-bottom:20px;">LIVE BID ACTIVITY</h3>
          <div style="max-height:400px;overflow-y:auto;">
            <ul style="list-style:none;padding:0;" id="activityList"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- FULL PLAYER LIST -->
    <div class="card" style="margin-top:40px;">
      <h3 style="color:var(--gold);font-size:2rem;margin-bottom:25px;">ALL PLAYERS (150+)</h3>
      <div style="max-height:600px;overflow-y:auto;">
        <table class="player-table" id="playerTable">
          <thead><tr><th>#</th><th>Player</th><th>Country</th><th>Role</th><th>Base</th><th>Status</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- LOGIN BOX -->
  <div class="login-box">
    <h2 style="font-size:2.5rem;margin-bottom:20px 0;color:var(--gold);">LOGIN</h2>
    <input type="text" id="username" placeholder="Username" autocomplete="off">
    <input type="password" id="password" placeholder="Password" autocomplete="off">
    <button class="btn btn-blue" onclick="doLogin()">ENTER</button>
    <p style="margin-top:30px;color:#64748b;font-size:1.1rem;">
      Public Viewer Active • Admin & Team Login Below
    </p>
  </div>

  <!-- ADMIN PANEL -->
  <div class="card admin-panel" id="adminPanel">
    <h2 style="color:var(--red);text-align:center;font-size:2.8rem;margin-bottom:30px;">ADMIN CONTROL</h2>
    <div style="display:flex;gap:25px;justify-content:center;flex-wrap:wrap;margin-bottom:40px;">
      <button class="btn btn-green" onclick="startAuction()" style="padding:20px 40px;font-size:1.5rem;">START AUCTION</button>
      <button class="btn btn-red" onclick="stopAuction()" style="padding:20px 40px;font-size:1.5rem;">STOP AUCTION</button>
    </div>
    <div class="admin-grid">
      <button class="btn btn-green" onclick="soldToCurrent()">SOLD</button>
      <button class="btn btn-red" onclick="unsoldCurrent()">UNSOLD</button>
      <button class="btn btn-purple" onclick="nextPlayer()">NEXT PLAYER</button>
      <button class="btn btn-orange" onclick="resetCurrentBid()">RESET BID</button>
      <button class="btn" onclick="addBid(0.25)">+0.25 Cr</button>
      <button class="btn" onclick="addBid(0.50)">+0.50 Cr</button>
      <button class="btn" onclick="addBid(1)">+1 Cr</button>
      <button class="btn" onclick="addBid(2)">+2 Cr</button>
      <button class="btn" onclick="addBid(5)">+5 Cr</button>
    </div>
    <h3 style="color:var(--gold);margin:40px 0 20px;">Change Team Password</h3>
    <select id="teamSelect" style="width:100%;padding:15px;border-radius:12px;background:#334155;color:white;margin-bottom:15px;"></select>
    <input type="text" id="newPass" placeholder="New Password" style="width:100%;padding:15px;border-radius:12px;background:#334155;color:white;">
    <button class="btn btn-purple" onclick="changeTeamPassword()" style="margin-top:20px;">UPDATE PASSWORD</button>
  </div>
</div>

<script>
// GLOBAL STATE
let players = [];
let teams = [];
let currentIndex = -1;
let auctionStarted = false;
let isAdmin = false;
let timerInterval;

// Load data
fetch('data.json')
  .then(r => r.json())
  .then(data => {
    players = data.players.map((p, i) => ({
      ...p,
      index: i,
      status: "waiting",
      highestBid: p.base_price_crore.toFixed(2),
      bidTeam: "No bids yet",
      bidTeamShort: "--",
      interested: [],
      activity: [{team:"Base", amount:`₹ ${p.base_price_crore} Cr`}]
    }));
    teams = data.teams;
    renderTeams();
    renderPlayerList();
  });

// Render Functions (ALL WORKING)
function renderTeams() {
  const tbody = document.querySelector("#teamTable tbody");
  tbody.innerHTML = "";
  teams.forEach(t => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${t.team_name}</td><td>₹${t.purse_crores} Cr</td><td>${t.overall_slots_left}</td><td>${t.overseas_slots_left}</td>`;
    tbody.appendChild(tr);
  });

  const sel = document.getElementById("teamSelect");
  sel.innerHTML = "";
  teams.forEach(t => {
    const opt = document.createElement("option");
    opt.value = t.username;
    opt.textContent = t.team_name;
    sel.appendChild(opt);
  });
}

function renderPlayerList() {
  const tbody = document.querySelector("#playerTable tbody");
  tbody.innerHTML = "";
  players.forEach((p, i) => {
    const tr = document.createElement("tr");
    const status = i === currentIndex ? "LIVE" : p.status.toUpperCase();
    tr.innerHTML = `<td>${i+1}</td><td>${p.name}</td><td>${p.country}</td><td>${p.role}</td><td>₹${p.base_price_crore} Cr</td><td style="color:${i===currentIndex?'var(--green)':'#94a3b8'}"><b>${status}</b></td>`;
    tbody.appendChild(tr);
  });
}

function showPlayer(idx) {
  if (idx < 0 || idx >= players.length) return;
  currentIndex = idx;
  const p = players[idx];

  document.getElementById("playerName").textContent = p.name;
  document.getElementById("playerInfo").textContent = `${p.role} • ${p.country} • Base: ₹${p.base_price_crore} Cr`;
  document.getElementById("playerPhoto").textContent = p.name.split(" ").map(n=>n[0]).join("").toUpperCase();
  document.getElementById("currentBid").textContent = `₹ ${p.highestBid} Cr`;
  document.getElementById("bidTeamName").textContent = p.bidTeam;
  document.getElementById("bidTeamLogo").textContent = p.bidTeamShort;

  const intDiv = document.getElementById("interestedTeams");
  intDiv.innerHTML = "";
  p.interested.forEach(t => {
    const span = document.createElement("span");
    span.className = "tag"; span.textContent = t; intDiv.appendChild(span);
  });

  const act = document.getElementById("activityList");
  act.innerHTML = "";
  p.activity.forEach(a => {
    const li = document.createElement("li");
    li.innerHTML = `<span>${a.team}</span><span style="color:var(--green)">${a.amount}</span>`;
    act.appendChild(li);
  });

  renderPlayerList();
}

function startTimer() {
  let time = 60;
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    time--;
    const m = String(Math.floor(time/60)).padStart(2,"0");
    const s = String(time%60).padStart(2,"0");
    document.getElementById("timer").textContent = `${m}:${s}`;
    if (time <= 0) nextPlayer();
  }, 1000);
}

function startAuction() {
  if (!isAdmin) return alert("Admin only!");
  auctionStarted = true;
  document.getElementById("notStartedBanner").style.display = "none";
  document.getElementById("statusText").textContent = "LIVE";
  document.getElementById("statusText").className = "status live";
  showPlayer(0);
  startTimer();
}

function stopAuction() {
  if (!isAdmin) return;
  auctionStarted = false;
  clearInterval(timerInterval);
  document.getElementById("statusText").textContent = "STOPPED";
  document.getElementById("statusText").className = "status stopped";
}

function nextPlayer() {
  if (currentIndex + 1 < players.length) {
    showPlayer(currentIndex + 1);
    if (auctionStarted) startTimer();
  } else {
    alert("AUCTION COMPLETED!");
    stopAuction();
  }
}

function soldToCurrent() {
  if (!isAdmin) return alert("Admin only!");
  players[currentIndex].status = "sold";
  alert(`${players[currentIndex].name} SOLD for ₹${players[currentIndex].highestBid} Cr!`);
  nextPlayer();
}

function unsoldCurrent() {
  if (!isAdmin) return alert("Admin only!");
  players[currentIndex].status = "unsold";
  alert(`${players[currentIndex].name} UNSOLD!`);
  nextPlayer();
}

function resetCurrentBid() {
  if (!isAdmin) return alert("Admin only!");
  const p = players[currentIndex];
  p.highestBid = p.base_price_crore.toFixed(2);
  p.bidTeam = "No bids yet";
  p.bidTeamShort = "--";
  p.interested = [];
  p.activity = [{team:"Base",amount:`₹ ${p.base_price_crore} Cr`}];
  showPlayer(currentIndex);
}

function addBid(amount) {
  if (!isAdmin) return alert("Admin only!");
  const p = players[currentIndex];
  const newBid = (parseFloat(p.highestBid) + amount).toFixed(2);
  p.highestBid = newBid;

  const randomTeam = teams[Math.floor(Math.random()*teams.length)];
  p.bidTeam = randomTeam.team_name;
  p.bidTeamShort = randomTeam.team_name.split(" ").pop().slice(0,3).toUpperCase();
  p.interested.push(randomTeam.team_name.split(" ").pop());
  p.activity.push({team: randomTeam.team_name, amount: `₹ ${newBid} Cr`});
  showPlayer(currentIndex);
}

function changeTeamPassword() {
  if (!isAdmin) return alert("Admin only!");
  const username = document.getElementById("teamSelect").value;
  const newP = document.getElementById("newPass").value.trim();
  if (!newP) return alert("Enter new password");
  const team = teams.find(t => t.username === username);
  if (team) {
    team.password = newP;
    alert(`Password changed for ${team.team_name}!`);
    document.getElementById("newPass").value = "";
  }
}

function doLogin() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value;

  // ADMIN LOGIN - HIDDEN FROM CODE
  if (u === "qwertyuiop" && p === "bluezone0025") {
    isAdmin = true;
    document.getElementById("adminPanel").style.display = "block";
    document.getElementById("soldUnsoldButtons").style.display = "flex";
    alert("ADMIN LOGIN SUCCESS! Full control activated.");
    return;
  }

  // Team login
  const team = teams.find(t => t.username === u && t.password === p);
  if (team) {
    alert(`Welcome ${team.team_name}!`);
  } else {
    alert("Invalid credentials");
  }
}

// Hide sold/unsold buttons for viewers
document.getElementById("soldUnsoldButtons").style.display = "none";
</script>
</body>
</html>
